<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>3D Charts with A-Frame and BabiaXR</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-babia-components/dist/aframe-babia-components.min.js"></script>
  <script src="https://unpkg.com/aframe-environment-component@1.0.0/dist/aframe-environment-component.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.2.0/dist/aframe-extras.min.js"></script>
  <script src="https://unpkg.com/aframe-orbit-controls-component/dist/aframe-orbit-controls-component.min.js"></script>
  <link rel="stylesheet" href="output.css">
  <link rel="stylesheet" href="styles.css">

  <script>
    AFRAME.registerComponent('pause-animation-on-hover', {
      init: function () {
        this.el.addEventListener('mouseenter', () => {
          this.el.components.animation.pause();
        });
        this.el.addEventListener('mouseleave', () => {
          this.el.components.animation.play();
        });
      }
    });
  </script>
</head>
<body>
    <a-scene>
        <!-- Importar ambiente de oficina -->
        <a-assets>
            <a-asset-item id="office" src="assets/escenaaeggrafic2.glb"></a-asset-item>
        </a-assets>

        <!-- Entorno de la oficina -->
        <a-entity 
        gltf-model="#office" 
        scale="120 100 120" 
        rotation="0 270 0" 
        position="-49 109 -970"></a-entity>

        <!-- Light -->
        <a-light type="point" intensity="1" position="-10 166 30"></a-light>

        <!-- Camera with Orbit Controls -->
        <a-entity position="0.803 80 105">
            <a-entity camera look-controls orbit-controls="
                autoRotate: false; 
                enableDamping: true; 
                dampingFactor: 0.25; 
                rotateSpeed: 0.25; 
                minDistance: 1; 
                maxDistance: 20;
                enableZoom: true;
                zoomSpeed: 1.0;">
            </a-entity>
            <a-entity cursor="rayOrigin: mouse"></a-entity>
            <a-entity laser-controls="hand: right"></a-entity>
        </a-entity>

        <!-- Pie Charts -->
        <a-entity id="pieChart1" babia-pie='
        legend: true; palette: blues; key: TIPOCURSO_DESC; size: Recuento de TIPOCURSO_DESC;
        data: [
            {"TIPOCURSO_DESC": "Formación - Curso de formación online", "Recuento de TIPOCURSO_DESC": 12798},
            {"TIPOCURSO_DESC": "Formación - Curso de Formación", "Recuento de TIPOCURSO_DESC": 5142},
            {"TIPOCURSO_DESC": "Formación - Certificado de Profesionalidad", "Recuento de TIPOCURSO_DESC": 3202},
            {"TIPOCURSO_DESC": "PFAs - Curso de Formación", "Recuento de TIPOCURSO_DESC": 3169},
            {"TIPOCURSO_DESC": "Talleres - Curso de Formación", "Recuento de TIPOCURSO_DESC": 2744},
            {"TIPOCURSO_DESC": "PFAs - Certificado de Profesionalidad", "Recuento de TIPOCURSO_DESC": 2403},
            {"TIPOCURSO_DESC": "Otros - Itinerario sociolaboral", "Recuento de TIPOCURSO_DESC": 1002},
            {"TIPOCURSO_DESC": "Formación - Módulo", "Recuento de TIPOCURSO_DESC": 801},
            {"TIPOCURSO_DESC": "Talleres - Certificado de Profesionalidad", "Recuento de TIPOCURSO_DESC": 439},
            {"TIPOCURSO_DESC": "Formación - Especialidad Formativa Sepe", "Recuento de TIPOCURSO_DESC": 319},
            {"TIPOCURSO_DESC": "Otros - Seminario", "Recuento de TIPOCURSO_DESC": 260},
            {"TIPOCURSO_DESC": "Otros - Curso de Formación", "Recuento de TIPOCURSO_DESC": 188},
            {"TIPOCURSO_DESC": "Otros - Reinvención", "Recuento de TIPOCURSO_DESC": 101}]'
        position="267 115.90 -316" 
        rotation="90 0 0" 
        scale="70 20 70" 
        visible="false"></a-entity>
            
        <a-entity id="pieChart2" babia-pie='
        legend: true; palette: sunset; key: AZ; size: Recuento de AZ;
        data: [
            {"AZ": "AZ Puente Vallecas","Recuento de AZ": 167687},
            {"AZ": "AZ Villaverde","Recuento de AZ": 116132},
            {"AZ": "AZ Vicálvaro","Recuento de AZ": 112788},
            {"AZ": "AZ Arganzuela","Recuento de AZ": 97564},
            {"AZ": "AZ Hortaleza-Barajas","Recuento de AZ": 91168},
            {"AZ": "Programas Fomento Empleo","Recuento de AZ": 85437},
            { "AZ": "AZ Carabanchel","Recuento de AZ": 81646},
            { "AZ": "AZ Retiro","Recuento de AZ": 79265},
            {"AZ": "AZ Tetúan","Recuento de AZ": 73415},
            { "AZ": "Talento y Empresas", "Recuento de AZ": 28011},
            { "AZ": "AutoEmpleo","Recuento de AZ": 9590},
            {"AZ": "Formación", "Recuento de AZ": 1491},
            {"AZ": "Programas Especiales","Recuento de AZ": 1064},
            { "AZ": "AZ-Otros Municipios","Recuento de AZ": 636}]' 
        position="-360 115.90 -320" 
        rotation="90 0 0" 
        scale="70 20 70" 
        visible="false"></a-entity>

        <!--<a-entity id="pieChart3" babia-pie='
        legend: true; palette: flat; key: CNAE_DESC; size: Recuent_de_CNAE_DESC;
        data: [
            { "CNAE_DESC": "Industria de productos alimenticios y bebidas", "Recuento_de_CNAE_DESC": 1354 },
            { "CNAE_DESC": "Industria química", "Recuento_de_CNAE_DESC": 314 },
            { "CNAE_DESC": "Producción y distribución de energía eléctrica, gas, vapor y agua caliente", "Recuento_de_CNAE_DESC": 264 },
            { "CNAE_DESC": "Edición, artes gráficas y reproducción de soportes grabados", "Recuento_de_CNAE_DESC": 252 },
            { "CNAE_DESC": "Fabricación de textiles y productos textiles", "Recuento_de_CNAE_DESC": 165 },
            { "CNAE_DESC": "Metalurgia", "Recuento_de_CNAE_DESC": 153 },
            { "CNAE_DESC": "Industria de la construcción de maquinaria y equipo mecánico", "Recuento_de_CNAE_DESC": 113 },
            { "CNAE_DESC": "Fabricación de vehículos de motor, remolques y semirremolques", "Recuento_de_CNAE_DESC": 104 },
            { "CNAE_DESC": "Fabricación de material electrónico. Fabricación de equipo y aparatos de radio, televisión y comunicaciones", "Recuento_de_CNAE_DESC": 154 },
            { "CNAE_DESC": "Industria de la confección y de la peletería", "Recuento_de_CNAE_DESC": 24 },
            { "CNAE_DESC": "Industria del papel", "Recuento_de_CNAE_DESC": 18 },
            { "CNAE_DESC": "Fabricación de productos de caucho y materias plásticas", "Recuento_de_CNAE_DESC": 41 },
            { "CNAE_DESC": "Reciclaje", "Recuento_de_CNAE_DESC": 47 },
            { "CNAE_DESC": "Fabricación de muebles. Otras industrias manufactureras", "Recuento_de_CNAE_DESC": 49 },
            { "CNAE_DESC": "Fabricación de equipo e instrumentos medico-quirúrgicos, de precisión óptica y relojería", "Recuento_de_CNAE_DESC": 11 },
            { "CNAE_DESC": "Industria de la madera y del corcho, excepto muebles, cestería y espartería", "Recuento_de_CNAE_DESC": 11 }
        ]' position="-364 110.4 -170.5" 
        rotation="90 0 0" 
        scale="70 20 70" 
        visible="false"
        >
        </a-entity>-->

      <!--  <a-entity id="pieChart4" babia-pie='
      legend: true; palette: foxy; key: CNAE_DESC; size: Recuento_de_CNAE_DESC; 
      data: [
        { "CNAE_DESC": "Administración pública, defensa y seguridad social obligatoria", "Recuento_de_CNAE_DESC": 13273 },
        { "CNAE_DESC": "Actividades sanitarias y veterinarias, servicios sociales", "Recuento_de_CNAE_DESC": 5637 },
        { "CNAE_DESC": "Hostelería", "Recuento_de_CNAE_DESC": 4977 },
        { "CNAE_DESC": "Comercio al por menor, excepto el comercio de vehículos de motor, motocicletas y ciclomotores, reparación de efectos personales y enseres domésticos", "Recuento_de_CNAE_DESC": 7941 },
        { "CNAE_DESC": "Comercio al por mayor e intermediarios del comercio, excepto de vehículos de motor y motocicletas", "Recuento_de_CNAE_DESC": 4672 },
        { "CNAE_DESC": "Actividades recreativas, culturales y deportivas", "Recuento_de_CNAE_DESC": 998 },
        { "CNAE_DESC": "Actividades diversas de servicios personales", "Recuento_de_CNAE_DESC": 1012 },
        { "CNAE_DESC": "Actividades asociativas", "Recuento_de_CNAE_DESC": 1212 },
        { "CNAE_DESC": "Educación", "Recuento_de_CNAE_DESC": 1109 },
        { "CNAE_DESC": "Transporte terrestre Transporte por tuberías", "Recuento_de_CNAE_DESC": 1146 },
        { "CNAE_DESC": "Actividades anexas a los transportes Actividades de agencias de viaje", "Recuento_de_CNAE_DESC": 415 },
        { "CNAE_DESC": "Hogares que emplean personal doméstico", "Recuento_de_CNAE_DESC": 391 },
        { "CNAE_DESC": "Actividades inmobiliarias", "Recuento_de_CNAE_DESC": 388 },
        { "CNAE_DESC": "Actividades de saneamiento privado", "Recuento_de_CNAE_DESC": 296 },
        { "CNAE_DESC": "Correos y telecomunicaciones", "Recuento_de_CNAE_DESC": 123 },
        { "CNAE_DESC": "Actividades auxiliares a la intermediación financiera", "Recuento_de_CNAE_DESC": 73 },
        { "CNAE_DESC": "Actividades informáticas", "Recuento_de_CNAE_DESC": 804 }
      ]' 
      position="264 73 -198.6" 
      rotation="90 0 0" 
      scale="70 20 70"
      visible="false">
    </a-entity>-->

      <!--<a-entity id="pieChart5" babia-pie='
        legend: true; palette: ubuntu; key: CNAE_DESC; size: Recuento_de_CNAE_DESC; 
        data: [
            { "CNAE_DESC": "Agricultura, ganadería caza y actividades de los servicios relacionados con las mismas", "Recuento_de_CNAE_DESC": 1088 },
            { "CNAE_DESC": "Pesca, acuicultura y actividades de los servicios relacionados con las mismas", "Recuento_de_CNAE_DESC": 49 },
            { "CNAE_DESC": "Extracción de crudos de petróleo y gas natural Actividades de los servicios relacionados con las explotaciones petrolíferas y de gas, excepto actividades de prospección", "Recuento_de_CNAE_DESC": 30 },
            { "CNAE_DESC": "Selvicultura, explotación forestal y actividades de los servicios relacionados con las mismas", "Recuento_de_CNAE_DESC": 71 },
            { "CNAE_DESC": "Transporte aéreo y espacial", "Recuento_de_CNAE_DESC": 32 },
            { "CNAE_DESC": "Transporte marítimo, de cabotaje y otras vías de navegación interiores", "Recuento_de_CNAE_DESC": 16 },
            { "CNAE_DESC": "Transporte terrestre, Transporte por tuberías", "Recuento_de_CNAE_DESC": 1146 },
            { "CNAE_DESC": "Actividades anexas a los transportes, Actividades de agencias de viaje", "Recuento_de_CNAE_DESC": 415 }
        ]' 
        position="-36 102.7 -345" 
        rotation="90 0 0" 
        scale="70 20 70"
        visible="false"
        pause-animation-on-hover>
        </a-entity>

        -->
        <a-video id="video" src="assets/saltavideosala.mp4" 
            width="25" 
            height="15" 
            position="-44 200 -710" 
            scale="20 20 20"
            visible="false"></a-video>

        <!-- Tarea de Descripción de Video -->
        <a-entity babia-task="taskVideo: true; taskVideoId: video"></a-entity>
    </a-scene>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const pieCharts = ['#pieChart1', '#pieChart2', '#pieChart3', '#pieChart4', '#pieChart5'];
        const video = document.querySelector('#video');
        let clickCount = 0;

        const toggleVisibility = async () => {
          if (clickCount === 0) {
            console.log('Mostrar gráficos');
            pieCharts.forEach(id => {
              const chart = document.querySelector(id);
              if (chart) {
                chart.setAttribute('visible', 'true');
              } else {
                console.error(`Gráfico no encontrado: ${id}`);
              }
            });
          } else if (clickCount === 1) {
            console.log('Ocultar gráficos');
            pieCharts.forEach(id => {
              const chart = document.querySelector(id);
              if (chart) {
                chart.setAttribute('visible', 'false');
              } else {
                console.error(`Gráfico no encontrado: ${id}`);
              }
            });
          } else if (clickCount === 2) {
            console.log('Mostrar y reproducir video');
            video.setAttribute('visible', 'true');
            await video.play();
          } else if (clickCount === 3) {
            console.log('Pausar y ocultar video');
            video.pause();
            video.setAttribute('visible', 'false');
          }
          clickCount = (clickCount + 1) % 4;
        };

        document.querySelector('a-scene').addEventListener('click', toggleVisibility);
      });
    </script>
</body>
</html>
